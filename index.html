<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ASMED CatÃ¡logo Online</title>
<style>
  body { font-family: Arial, sans-serif; margin:20px; background:#f9f9f9; }
  h1 { text-align:center; margin-bottom:20px; }
  #busqueda { width: 100%; padding:10px; margin-bottom:15px; font-size:16px; }
  #categorias { display:flex; flex-wrap:wrap; gap:10px; margin-bottom:20px; justify-content:center; }
  .categoria-btn { padding:10px 15px; background:#007bff; color:#fff; border:none; border-radius:8px; cursor:pointer; }
  .categoria-btn.active { background:#0056b3; }
  #productos { display:grid; grid-template-columns: repeat(auto-fill,minmax(200px,1fr)); gap:15px; }
  .producto { background:#fff; padding:15px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1); position:relative; }
  .producto img { width:100%; height:150px; object-fit:cover; border-radius:8px; margin-bottom:10px; }
  .producto h3 { margin:5px 0; font-size:18px; }
  .producto p { font-size:14px; margin:5px 0; color:#555; }
  .btns { display:flex; gap:5px; flex-wrap:wrap; margin-top:10px; }
  .btn { flex:1; padding:8px; border:none; border-radius:6px; cursor:pointer; font-size:14px; }
  .btn-whatsapp { background:#25D366; color:#fff; }
  .btn-carrito { background:#FFC107; color:#000; }
  /* Modal */
  .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; }
  .modal-content { background:#fff; padding:20px; border-radius:10px; width:90%; max-width:400px; position:relative; }
  .close { position:absolute; top:10px; right:15px; cursor:pointer; font-size:20px; }
  #carrito-btn { position:fixed; bottom:20px; right:20px; padding:12px 18px; background:#FF5722; color:#fff; border:none; border-radius:50px; cursor:pointer; font-size:16px; }
</style>
</head>
<body>

<h1>CatÃ¡logo ASMED</h1>

<input type="text" id="busqueda" placeholder="Buscar productos...">

<div id="categorias"></div>

<div id="productos"></div>

<button id="carrito-btn" onclick="verCarrito()">ðŸ›’ Ver pedido</button>

<!-- Modal de detalles -->
<div id="modal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="cerrarModal()">&times;</span>
    <h3 id="modal-nombre"></h3>
    <p id="modal-descripcion"></p>
    <p><strong>Stock:</strong> <span id="modal-stock"></span></p>
    <div class="btns">
      <button class="btn btn-whatsapp" id="modal-whatsapp">Consultar por WhatsApp</button>
      <button class="btn btn-carrito" id="modal-carrito">Agregar al pedido</button>
    </div>
  </div>
</div>

<script>
const url = "https://script.google.com/macros/s/AKfycbxRsNmhb3aSVpmt9QCQuTEcckobSJCm4ks7Giw0__Z-o8flU8-tqgS8-Jd1LAVUdhAb/exec";
let productos = [];
let categorias = [];
let pedido = JSON.parse(localStorage.getItem('pedido')) || [];

async function cargarProductos() {
  const res = await fetch(url);
  const data = await res.json();
  productos = data.filter(p => p.Mostrar === "âœ…");
  renderCategorias();
  renderProductos();
}

function renderCategorias() {
  const container = document.getElementById("categorias");
  container.innerHTML = "";
  categorias = [...new Set(productos.map(p => p.CategorÃ­a))];
  categorias.forEach(cat => {
    const btn = document.createElement("button");
    btn.textContent = cat;
    btn.className = "categoria-btn";
    btn.onclick = () => {
      document.querySelectorAll(".categoria-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      renderProductos(cat);
    };
    container.appendChild(btn);
  });
}

function renderProductos(filtroCat="") {
  const contenedor = document.getElementById("productos");
  const busqueda = document.getElementById("busqueda").value.toLowerCase();
  contenedor.innerHTML = "";

  productos
    .filter(p => (!filtroCat || p.CategorÃ­a === filtroCat) && 
                 (p.Nombre.toLowerCase().includes(busqueda) || p.DescripciÃ³n.toLowerCase().includes(busqueda)))
    .forEach(p => {
      const div = document.createElement("div");
      div.className = "producto";
      div.innerHTML = `
        <img src="${p.Imagen}" alt="${p.Nombre}">
        <h3>${p.Nombre}</h3>
        <p>${p.DescripciÃ³n}</p>
        <div class="btns">
          <button class="btn btn-whatsapp" onclick="abrirWhatsApp('${p.Nombre}')">WhatsApp</button>
          <button class="btn btn-carrito" onclick="agregarAlPedido('${p.Nombre}')">Agregar al pedido</button>
        </div>
      `;
      div.onclick = (e) => {
        if (!e.target.classList.contains("btn")) abrirModal(p);
      };
      contenedor.appendChild(div);
    });
}

document.getElementById("busqueda").addEventListener("input", () => renderProductos());

/* Modal */
function abrirModal(producto){
  document.getElementById("modal-nombre").textContent = producto.Nombre;
  document.getElementById("modal-descripcion").textContent = producto.DescripciÃ³n;
  document.getElementById("modal-stock").textContent = producto.Stock || "No disponible";
  document.getElementById("modal-whatsapp").onclick = () => abrirWhatsApp(producto.Nombre);
  document.getElementById("modal-carrito").onclick = () => agregarAlPedido(producto.Nombre);
  document.getElementById("modal").style.display = "flex";
}
function cerrarModal(){ document.getElementById("modal").style.display = "none"; }

/* WhatsApp individual */
function abrirWhatsApp(nombre){
  window.open(`https://wa.me/595974294751?text=${encodeURIComponent("Hola! Estoy interesado en " + nombre)}`, "_blank");
}

/* Carrito / lista de intereses */
function agregarAlPedido(nombre){
  if(!pedido.includes(nombre)) pedido.push(nombre);
  localStorage.setItem("pedido", JSON.stringify(pedido));
  alert(`${nombre} agregado al pedido ðŸ›’`);
}

function verCarrito(){
  if(pedido.length === 0){ alert("No hay productos en el pedido"); return; }
  const texto = "Hola! Estoy interesado en los siguientes productos:\n- " + pedido.join("\n- ");
  window.open(`https://wa.me/595974294751?text=${encodeURIComponent(texto)}`, "_blank");
}

cargarProductos();
</script>

</body>
</html>
