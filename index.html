<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ASMED - Cat√°logo Online</title>
<style>
:root{
  --bg:#f6f7fb;
  --card:#fff;
  --accent:#0cb2ba;
  --muted:#666;
}
body{font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;margin:0;background:var(--bg);color:#222}
.app{max-width:1100px;margin:24px auto;padding:16px}
header{display:flex;flex-direction:column;gap:12px;margin-bottom:16px}
h1{font-size:20px;margin:0}
.controls{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
input.search{padding:10px 12px;border-radius:8px;border:1px solid #ddd;flex:1;min-width:250px;box-sizing:border-box}
.category-buttons{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
.category-btn{padding:6px 12px;border-radius:999px;border:1px solid var(--accent);background:white;color:var(--accent);cursor:pointer;font-weight:600;font-size:13px;transition:0.2s}
.category-btn.active{background:var(--accent);color:white}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px;position:relative}
.card{background:var(--card);border-radius:12px;padding:12px;box-shadow:0 6px 18px rgba(20,20,50,0.06);cursor:pointer;display:flex;flex-direction:column;gap:8px;min-height:160px;position:relative;overflow:hidden;transition:0.2s}
.thumb{height:100px;background:linear-gradient(135deg,#e9eefc,#fff);border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:600;color:var(--muted)}
.meta{display:flex;justify-content:space-between;align-items:center;font-size:13px}
.cat{padding:4px 8px;border-radius:999px;background:#f0f4ff;color:var(--accent);font-weight:600;font-size:12px}
.name{font-weight:700}
.btns{display:flex;gap:5px;margin-top:10px;opacity:0;transition:0.2s;pointer-events:none;flex-direction:column}
.card:hover .btns{opacity:1;pointer-events:auto}
.btn{flex:1;padding:6px;border:none;border-radius:6px;cursor:pointer;font-size:13px;font-weight:600}
.btn-whatsapp{background:#25D366;color:#fff}
.btn-carrito{background:var(--accent);color:#fff}
/* modal */
.modal-back{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;padding:18px;z-index:60}
.modal{width:100%;max-width:720px;background:var(--card);border-radius:14px;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,0.25)}
.modal .row{display:flex;gap:12px}
.modal .left{flex:1}
.modal .right{width:220px}
.close{border:none;background:none;font-size:18px;cursor:pointer;color:#444}
.whatsapp-btn{display:inline-block;padding:10px 12px;border-radius:10px;background:#25D366;color:white;text-decoration:none;font-weight:700;margin-top:8px}
.small{font-size:13px;color:var(--muted)}
/* loader */
.loader-back{position:absolute;inset:0;background:rgba(255,255,255,0.85);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;z-index:50;font-size:14px;color:var(--accent)}
.loader-circle{font-size:32px;animation:pulse 1s infinite}
@keyframes pulse{0%,100%{transform:scale(1);}50%{transform:scale(1.3);}}

/* carrito flotante */
#cartBtn{position:fixed;bottom:20px;right:20px;background:var(--accent);color:#fff;padding:12px 18px;border-radius:999px;font-weight:700;z-index:99;cursor:pointer}
#cartSection{margin-top:40px;padding:12px;border-radius:12px;background:#fff;box-shadow:0 6px 18px rgba(20,20,50,0.06)}
.cart-item{display:flex;justify-content:space-between;align-items:center;padding:4px 6px;border-bottom:1px solid #eee}
.cart-item button{background:red;color:white;padding:2px 6px;border-radius:4px;font-size:12px;border:none;cursor:pointer}
@media(max-width:720px){.modal .row{flex-direction:column}.controls{flex-direction:column;align-items:stretch}input.search{width:100%}}
</style>
</head>
<body>
<div class="app">
  <header>
    <h1>ASMED - Cat√°logo Online</h1>
    <div class="controls">
      <input class="search" placeholder="Buscar por nombre, c√≥digo o descripci√≥n..." id="searchInput" />
    </div>
    <div class="category-buttons" id="categoryButtons"></div>
  </header>
  <main>
    <div id="stats" class="small" style="margin-bottom:8px">Mostrando <span id="count">0</span> productos</div>
    <div class="grid" id="grid">
      <div class="loader-back" id="loader">
        <div class="loader-circle">üîµ</div>
        <div>Cargando productos...</div>
      </div>
    </div>
    <div id="cartSection">
      <h2>Carrito de pedidos</h2>
      <div id="cartItems"></div>
      <button id="sendCartBtn" class="btn btn-carrito">Enviar pedido por WhatsApp</button>
    </div>
</main>
</div>
<button id="cartBtn">0 Productos</button>

<!-- Modal -->
<div class="modal-back" id="modalBack" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
      <strong id="mTitle">Producto</strong>
      <button class="close" id="closeModal">‚úï</button>
    </div>
    <div class="row">
      <div class="left">
        <div style="height:200px;border-radius:8px;background:#fafbff;display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:700;margin-bottom:12px" id="mThumb">IMAGEN</div>
        <div id="mDesc" class="small" style="line-height:1.4"></div>
      </div>
      <div class="right">
        <div style="display:flex;flex-direction:column;gap:10px">
          <div><span class="small">C√≥digo</span><div id="mCode" style="font-weight:700"></div></div>
          <div><span class="small">Categor√≠a</span><div id="mCat" class="small" style="font-weight:700;color:var(--accent)"></div></div>
          <div style="display:flex;flex-direction:column;gap:6px;margin-top:10px">
            <button id="modalCarrito" class="btn btn-carrito">Agregar al pedido</button>
            <a id="waBtn" class="whatsapp-btn" href="#" target="_blank" rel="noopener">Consultar por WhatsApp</a>
          </div>
          <div style="margin-top:12px" class="small">* Demo de cat√°logo online.</div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// ---------- CONFIG ----------
const execUrl="https://script.google.com/macros/s/AKfycbwv3yDBDgdiri4jErMve19FUJ9udPV-x31u1ZHT4BsW2i1e1G57oSUXvEu0rAb14Mab/exec";
let products=[], filtered=[], pedido=JSON.parse(localStorage.getItem('pedido'))||[];

// ---------- DOM ----------
const grid=document.getElementById('grid');
const loader=document.getElementById('loader');
const searchInput=document.getElementById('searchInput');
const countSpan=document.getElementById('count');
const modalBack=document.getElementById('modalBack');
const closeModal=document.getElementById('closeModal');
const mTitle=document.getElementById('mTitle');
const mThumb=document.getElementById('mThumb');
const mDesc=document.getElementById('mDesc');
const mCode=document.getElementById('mCode');
const mCat=document.getElementById('mCat');
const waBtn=document.getElementById('waBtn');
const modalCarrito=document.getElementById('modalCarrito');
const categoryButtons=document.getElementById('categoryButtons');
const cartBtn=document.getElementById('cartBtn');
const cartItems=document.getElementById('cartItems');
const sendCartBtn=document.getElementById('sendCartBtn');

// ---------- FETCH DATA ----------
fetch(execUrl)
.then(res=>res.json())
.then(data=>{
  products=data;
  filtered=products.slice();
  populateCategories();
  renderList(filtered);
  updateCartDisplay();
  loader.style.display='none';
})
.catch(err=>{console.error(err);loader.innerHTML='Error al cargar productos';});

// ---------- FUNCIONES ----------
function populateCategories(){
  const cats=Array.from(new Set(products.map(p=>p.category))).sort();
  cats.forEach(cat=>{
    const btn=document.createElement('button');
    btn.textContent=cat;
    btn.className='category-btn';
    btn.addEventListener('click',()=>{
      document.querySelectorAll('.category-btn').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      filtered=products.filter(p=>p.category===cat);
      renderList(filtered);
    });
    categoryButtons.appendChild(btn);
  });
}

function renderList(list){
  grid.innerHTML='';
  countSpan.textContent=list.length;
  if(!list.length){grid.innerHTML='<div style="grid-column:1/-1;padding:28px;background:#fff;border-radius:10px;text-align:center">No se encontraron productos</div>';return;}
  list.forEach(p=>{
    const card=document.createElement('div');
    card.className='card';
    card.tabIndex=0;
    card.innerHTML=`
      <div class="thumb">${p.name.split(' ').slice(0,3).join(' ')}</div>
      <div style="flex:1">
        <div class="meta"><div class="name">${p.name}</div><div class="cat">${p.category}</div></div>
        <div style="margin-top:8px"><div class="small">${p.desc}</div></div>
      </div>
    `;
    card.addEventListener('click',()=>openModal(p));
    grid.appendChild(card);
  });
}

// ---------- MODAL ----------
let currentProduct=null;
function openModal(p){
  currentProduct=p;
  mTitle.textContent=p.name;
  mThumb.textContent=p.code;
  mDesc.textContent=p.desc+'\n\nStock disponible: '+p.stock;
  mCode.textContent=p.code;
  mCat.textContent=p.category;
  const waMsg=encodeURIComponent(`Hola, quiero consultar por *${p.name}* (c√≥digo: ${p.code}).`);
  const phone="595974294751";
  waBtn.href=`https://wa.me/${phone}?text=${waMsg}`;
  modalBack.style.display='flex';
  modalBack.setAttribute('aria-hidden','false');
}
closeModal.addEventListener('click',()=>{modalBack.style.display='none'; modalBack.setAttribute('aria-hidden','true');});
modalBack.addEventListener('click',(e)=>{if(e.target===modalBack){modalBack.style.display='none'; modalBack.setAttribute('aria-hidden','true');}});

// ---------- CARRITO ----------
function updateCartDisplay(){
  cartItems.innerHTML='';
  pedido.forEach((p,i)=>{
    const div=document.createElement('div');
    div.className='cart-item';
    div.innerHTML=`${p.name} <button data-index="${i}">Eliminar</button>`;
    div.querySelector('button').addEventListener('click',()=>{pedido.splice(i,1); saveCart(); updateCartDisplay();});
    cartItems.appendChild(div);
  });
  cartBtn.textContent=`${pedido.length} Productos`;
}

function saveCart(){localStorage.setItem('pedido',JSON.stringify(pedido));}

modalCarrito.addEventListener('click',()=>{
  if(currentProduct && !pedido.find(p=>p.id===currentProduct.id)){pedido.push(currentProduct); saveCart(); updateCartDisplay();}
  modalBack.style.display='none';
});

cartBtn.addEventListener('click',()=>{document.getElementById('cartSection').scrollIntoView({behavior:'smooth'});});

sendCartBtn.addEventListener('click',()=>{
  if(!pedido.length)return alert('El carrito est√° vac√≠o');
  let msg='Hola, quisiera hacer el siguiente pedido:\n';
  pedido.forEach(p=>{msg+=`- ${p.name} (c√≥digo: ${p.code})\n`;});
  const phone="595974294751";
  window.open(`https://wa.me/${phone}?text=${encodeURIComponent(msg)}`, '_blank');
});

searchInput.addEventListener('input',()=>{applyFilters();});

function applyFilters(){
  const q=searchInput.value.trim().toLowerCase();
  filtered=products.filter(p=>p.name.toLowerCase().includes(q)||p.code.toLowerCase().includes(q)||p.desc.toLowerCase().includes(q));
  renderList(filtered);
}

</script>
</body>
</html>
